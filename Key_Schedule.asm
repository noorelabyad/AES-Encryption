; multi-segment executable file template.

data segment

CHJ DB 0
COUNTER1DB DB 10H
COUNTER1DW DW 0010H
COUNTER2DB DB 20H
COUNTER2DW DW 0020H
COUNTER DW 0004H

 
ends


code segment
MOV BX,1600H
MOV BX,1100H

;ROW 0
MOV SI, 0

MOV AL, 63H
MOV [BX+SI+0], AL
MOV AL, 7CH
MOV [BX+SI+1], AL
MOV AL, 77H
MOV [BX+SI+2], AL
MOV AL, 7BH
MOV [BX+SI+3], AL
MOV AL, 0F2H
MOV [BX+SI+4], AL
MOV AL, 6BH
MOV [BX+SI+5], AL
MOV AL, 6FH
MOV [BX+SI+6], AL
MOV AL, 0C5H
MOV [BX+SI+7], AL
MOV AL, 30H
MOV [BX+SI+8], AL
MOV AL, 01H
MOV [BX+SI+9], AL
MOV AL, 67H
MOV [BX+SI+10], AL
MOV AL, 2BH
MOV [BX+SI+11], AL
MOV AL, 0FEH
MOV [BX+SI+12], AL
MOV AL, 0D7H
MOV [BX+SI+13], AL
MOV AL, 0ABH
MOV [BX+SI+14], AL
MOV AL, 76H
MOV [BX+SI+15], AL

;ROW 1
MOV SI, 16

MOV AL, 0CAH
MOV [BX+SI+0], AL
MOV AL, 82H
MOV [BX+SI+1], AL
MOV AL, 0C9H
MOV [BX+SI+2], AL
MOV AL, 7DH
MOV [BX+SI+3], AL
MOV AL, 0FAH
MOV [BX+SI+4], AL
MOV AL, 59H
MOV [BX+SI+5], AL
MOV AL, 47H
MOV [BX+SI+6], AL
MOV AL, 0F0H
MOV [BX+SI+7], AL
MOV AL, 0ADH
MOV [BX+SI+8], AL
MOV AL, 0D4H
MOV [BX+SI+9], AL
MOV AL, 0A2H
MOV [BX+SI+10], AL
MOV AL, 0AFH
MOV [BX+SI+11], AL
MOV AL, 9CH
MOV [BX+SI+12], AL
MOV AL, 0A4H
MOV [BX+SI+13], AL
MOV AL, 72H
MOV [BX+SI+14], AL
MOV AL, 0C0H
MOV [BX+SI+15], AL

;ROW 2
MOV SI, 32

MOV AL, 0B7H
MOV [BX+SI+0], AL
MOV AL, 0FDH
MOV [BX+SI+1], AL
MOV AL, 93H
MOV [BX+SI+2], AL
MOV AL, 26H
MOV [BX+SI+3], AL
MOV AL, 36H
MOV [BX+SI+4], AL
MOV AL, 3FH
MOV [BX+SI+5], AL
MOV AL, 0F7H
MOV [BX+SI+6], AL
MOV AL, 0CCH
MOV [BX+SI+7], AL
MOV AL, 34H
MOV [BX+SI+8], AL
MOV AL, 0A5H
MOV [BX+SI+9], AL
MOV AL, 0E5H
MOV [BX+SI+10], AL
MOV AL, 0F1H
MOV [BX+SI+11], AL
MOV AL, 71H
MOV [BX+SI+12], AL
MOV AL, 0D8H
MOV [BX+SI+13], AL
MOV AL, 31H
MOV [BX+SI+14], AL
MOV AL, 15H
MOV [BX+SI+15], AL

;ROW 3
MOV SI, 48

MOV AL, 04H
MOV [BX+SI+0], AL
MOV AL, 0C7H
MOV [BX+SI+1], AL
MOV AL, 23H
MOV [BX+SI+2], AL
MOV AL, 0C3H
MOV [BX+SI+3], AL
MOV AL, 18H
MOV [BX+SI+4], AL
MOV AL, 96H
MOV [BX+SI+5], AL
MOV AL, 05H
MOV [BX+SI+6], AL
MOV AL, 9AH
MOV [BX+SI+7], AL
MOV AL, 07H
MOV [BX+SI+8], AL
MOV AL, 12H
MOV [BX+SI+9], AL
MOV AL, 80H
MOV [BX+SI+10], AL
MOV AL, 0E2H
MOV [BX+SI+11], AL
MOV AL, 0EBH
MOV [BX+SI+12], AL
MOV AL, 27H
MOV [BX+SI+13], AL
MOV AL, 0B2H
MOV [BX+SI+14], AL
MOV AL, 75H
MOV [BX+SI+15], AL

;ROW 4
MOV SI, 64

MOV AL, 09H
MOV [BX+SI+0], AL
MOV AL, 83H
MOV [BX+SI+1], AL
MOV AL, 2CH
MOV [BX+SI+2], AL
MOV AL, 1AH
MOV [BX+SI+3], AL
MOV AL, 1BH
MOV [BX+SI+4], AL
MOV AL, 6EH
MOV [BX+SI+5], AL
MOV AL, 5AH
MOV [BX+SI+6], AL
MOV AL, 0A0H
MOV [BX+SI+7], AL
MOV AL, 52H
MOV [BX+SI+8], AL
MOV AL, 3BH
MOV [BX+SI+9], AL
MOV AL, 0D6H
MOV [BX+SI+10], AL
MOV AL, 0B3H
MOV [BX+SI+11], AL
MOV AL, 29H
MOV [BX+SI+12], AL
MOV AL, 0E3H
MOV [BX+SI+13], AL
MOV AL, 2FH
MOV [BX+SI+14], AL
MOV AL, 84H
MOV [BX+SI+15], AL
 
 
;ROW 5
MOV SI, 80

MOV AL, 53H
MOV [BX+SI+0], AL
MOV AL, 0D1H
MOV [BX+SI+1], AL
MOV AL, 00H
MOV [BX+SI+2], AL
MOV AL, 0EDH
MOV [BX+SI+3], AL
MOV AL, 20H
MOV [BX+SI+4], AL
MOV AL, 0FCH
MOV [BX+SI+5], AL
MOV AL, 0B1H
MOV [BX+SI+6], AL
MOV AL, 5BH
MOV [BX+SI+7], AL
MOV AL, 6AH
MOV [BX+SI+8], AL
MOV AL, 0CBH
MOV [BX+SI+9], AL
MOV AL, 0BEH
MOV [BX+SI+10], AL
MOV AL, 39H
MOV [BX+SI+11], AL
MOV AL, 4AH
MOV [BX+SI+12], AL
MOV AL, 4CH
MOV [BX+SI+13], AL
MOV AL, 58H
MOV [BX+SI+14], AL
MOV AL, 0CFH
MOV [BX+SI+15], AL

;ROW 6
MOV SI, 96

MOV AL, 0D0H
MOV [BX+SI+0], AL
MOV AL, 0EFH
MOV [BX+SI+1], AL
MOV AL, 0AAH
MOV [BX+SI+2], AL
MOV AL, 0FBH
MOV [BX+SI+3], AL
MOV AL, 43H
MOV [BX+SI+4], AL
MOV AL, 4DH
MOV [BX+SI+5], AL
MOV AL, 33H
MOV [BX+SI+6], AL
MOV AL, 85H
MOV [BX+SI+7], AL
MOV AL, 45H
MOV [BX+SI+8], AL
MOV AL, 0F9H
MOV [BX+SI+9], AL
MOV AL, 02H
MOV [BX+SI+10], AL
MOV AL, 7FH
MOV [BX+SI+11], AL
MOV AL, 50H
MOV [BX+SI+12], AL
MOV AL, 3CH
MOV [BX+SI+13], AL
MOV AL, 9FH
MOV [BX+SI+14], AL
MOV AL, 0A8H
MOV [BX+SI+15], AL

;ROW 7
MOV SI, 112

MOV AL, 51H
MOV [BX+SI+0], AL

MOV AL, 0A3H
MOV [BX+SI+1], AL

MOV AL, 40H
MOV [BX+SI+2], AL

MOV AL, 8FH
MOV [BX+SI+3], AL

MOV AL, 92H
MOV [BX+SI+4], AL

MOV AL, 9DH
MOV [BX+SI+5], AL

MOV AL, 38H
MOV [BX+SI+6], AL

MOV AL, 0F5H
MOV [BX+SI+7], AL

MOV AL, 0BCH
MOV [BX+SI+8], AL

MOV AL, 0B6H
MOV [BX+SI+9], AL

MOV AL, 0DAH
MOV [BX+SI+10], AL

MOV AL, 21H
MOV [BX+SI+11], AL 

MOV AL, 10H
MOV [BX+SI+12], AL  

MOV AL, 0FFH
MOV [BX+SI+13], AL 

MOV AL, 0F3H
MOV [BX+SI+14], AL 

MOV AL, 0D2H
MOV [BX+SI+15], AL

;ROW 8

MOV SI,128

MOV AL,0CDH
MOV [BX + SI + 0],AL

MOV AL,0CH
MOV [BX + SI + 1],AL

MOV AL,13H
MOV [BX + SI + 2],AL

MOV AL,0ECH
MOV [BX + SI + 3],AL

MOV AL,5FH
MOV [BX + SI + 4],AL

MOV AL,97H
MOV [BX + SI + 5],AL

MOV AL,44H
MOV [BX + SI + 6],AL

MOV AL,17H
MOV [BX + SI + 7],AL

MOV AL,0C4H
MOV [BX + SI + 8],AL

MOV AL,0A7H
MOV [BX + SI + 9],AL

MOV AL,7EH
MOV [BX + SI + 10],AL

MOV AL,3DH
MOV [BX + SI + 11],AL

MOV AL,64H
MOV [BX + SI + 12],AL

MOV AL,5DH
MOV [BX + SI + 13],AL

MOV AL,19H
MOV [BX + SI + 14],AL

MOV AL,73H
MOV [BX + SI + 15],AL

;ROW 9

MOV SI,144

MOV AL,60H
MOV [BX + SI + 0],AL

MOV AL,81H
MOV [BX + SI + 1],AL

MOV AL,4FH
MOV [BX + SI + 2],AL

MOV AL,0DCH
MOV [BX + SI + 3],AL

MOV AL,22H
MOV [BX + SI + 4],AL

MOV AL,2AH
MOV [BX + SI + 5],AL

MOV AL,90H
MOV [BX + SI + 6],AL

MOV AL,88H
MOV [BX + SI + 7],AL

MOV AL,46H
MOV [BX + SI + 8],AL

MOV AL,0EEH
MOV [BX + SI + 9],AL

MOV AL,0B8H
MOV [BX + SI + 10],AL

MOV AL,14H
MOV [BX + SI + 11],AL

MOV AL,0DEH
MOV [BX + SI + 12],AL

MOV AL,5EH
MOV [BX + SI + 13],AL

MOV AL,0BH
MOV [BX + SI + 14],AL

MOV AL,0DBH
MOV [BX + SI + 15],AL


;ROW A


MOV SI,160

MOV AL,0E0H
MOV [BX + SI + 0],AL

MOV AL,32H
MOV [BX + SI + 1],AL

MOV AL,3AH
MOV [BX + SI + 2],AL

MOV AL,0AH
MOV [BX + SI + 3],AL

MOV AL,49H
MOV [BX + SI + 4],AL

MOV AL,06H
MOV [BX + SI + 5],AL

MOV AL,24H
MOV [BX + SI + 6],AL

MOV AL,5CH
MOV [BX + SI + 7],AL

MOV AL,0C2H
MOV [BX + SI + 8],AL

MOV AL,0D3H
MOV [BX + SI + 9],AL

MOV AL,0ACH
MOV [BX + SI + 10],AL

MOV AL,62H
MOV [BX + SI + 11],AL

MOV AL,91H
MOV [BX + SI + 12],AL

MOV AL,95H
MOV [BX + SI + 13],AL

MOV AL,0E4H
MOV [BX + SI + 14],AL

MOV AL,79H
MOV [BX + SI + 15],AL


;ROW B

MOV SI,176

MOV AL,0E7H
MOV [BX + SI + 0],AL

MOV AL,0C8H
MOV [BX + SI + 1],AL

MOV AL,37H
MOV [BX + SI + 2],AL

MOV AL,6DH
MOV [BX + SI + 3],AL

MOV AL,8DH
MOV [BX + SI + 4],AL

MOV AL,0D5H
MOV [BX + SI + 5],AL

MOV AL,4EH
MOV [BX + SI + 6],AL

MOV AL,0A9H
MOV [BX + SI + 7],AL

MOV AL,6CH
MOV [BX + SI + 8],AL

MOV AL,56H
MOV [BX + SI + 9],AL

MOV AL,0F4H
MOV [BX + SI + 10],AL

MOV AL,0EAH
MOV [BX + SI + 11],AL

MOV AL,65H
MOV [BX + SI + 12],AL

MOV AL,7AH
MOV [BX + SI + 13],AL

MOV AL,0AEH
MOV [BX + SI + 14],AL

MOV AL,08H
MOV [BX + SI + 15],AL


;ROW C


MOV SI,192

MOV AL,0BAH
MOV [BX + SI + 0],AL

MOV AL,78H
MOV [BX + SI + 1],AL

MOV AL,25H
MOV [BX + SI + 2],AL

MOV AL,2EH
MOV [BX + SI + 3],AL

MOV AL,1CH
MOV [BX + SI + 4],AL

MOV AL,0A6H
MOV [BX + SI + 5],AL

MOV AL,0B4H
MOV [BX + SI + 6],AL

MOV AL,0C6H
MOV [BX + SI + 7],AL

MOV AL,0E8H
MOV [BX + SI + 8],AL

MOV AL,0DDH
MOV [BX + SI + 9],AL

MOV AL,74H
MOV [BX + SI + 10],AL

MOV AL,1FH
MOV [BX + SI + 11],AL

MOV AL,4BH
MOV [BX + SI + 12],AL

MOV AL,0BDH
MOV [BX + SI + 13],AL

MOV AL,8BH
MOV [BX + SI + 14],AL

MOV AL,8AH
MOV [BX + SI + 15],AL



;ROW D

MOV SI,208

MOV AL,70H
MOV [BX + SI + 0],AL

MOV AL,3EH
MOV [BX + SI + 1],AL

MOV AL,0B5H
MOV [BX + SI + 2],AL

MOV AL,66H
MOV [BX + SI + 3],AL

MOV AL,48H
MOV [BX + SI + 4],AL

MOV AL,03H
MOV [BX + SI + 5],AL

MOV AL,0F6H
MOV [BX + SI + 6],AL

MOV AL,0EH
MOV [BX + SI + 7],AL

MOV AL,61H
MOV [BX + SI + 8],AL

MOV AL,35H
MOV [BX + SI + 9],AL

MOV AL,57H
MOV [BX + SI + 10],AL

MOV AL,0B9H
MOV [BX + SI + 11],AL

MOV AL,86H
MOV [BX + SI + 12],AL

MOV AL,0C1H
MOV [BX + SI + 13],AL

MOV AL,1DH
MOV [BX + SI + 14],AL

MOV AL,9EH
MOV [BX + SI + 15],AL


;ROW E
MOV SI, 224

MOV AL, 0E1H
MOV [BX+SI+0], AL

MOV AL, 0F8H
MOV [BX+SI+1], AL

MOV AL, 98H
MOV [BX+SI+2], AL

MOV AL, 11H
MOV [BX+SI+3], AL

MOV AL, 69H
MOV [BX+SI+4], AL

MOV AL, 0D9H
MOV [BX+SI+5], AL

MOV AL, 8EH
MOV [BX+SI+6], AL

MOV AL, 94H
MOV [BX+SI+7], AL

MOV AL, 9BH
MOV [BX+SI+8], AL

MOV AL, 1EH
MOV [BX+SI+9], AL

MOV AL, 87H
MOV [BX+SI+10], AL

MOV AL, 0E9H
MOV [BX+SI+11], AL

MOV AL, 0CEH
MOV [BX+SI+12], AL

MOV AL, 55H
MOV [BX+SI+13], AL

MOV AL, 28H
MOV [BX+SI+14], AL

MOV AL, 0DFH
MOV [BX+SI+15], AL

;ROW F
MOV SI, 240

MOV AL, 8CH
MOV [BX+SI+0], AL

MOV AL, 0A1H
MOV [BX+SI+1], AL

MOV AL, 89H
MOV [BX+SI+2], AL

MOV AL, 0DH
MOV [BX+SI+3], AL

MOV AL, 0BFH
MOV [BX+SI+4], AL

MOV AL, 0E6H
MOV [BX+SI+5], AL

MOV AL, 42H
MOV [BX+SI+6], AL

MOV AL, 68H
MOV [BX+SI+7], AL

MOV AL, 41H
MOV [BX+SI+8], AL

MOV AL, 99H
MOV [BX+SI+9], AL

MOV AL, 2DH
MOV [BX+SI+10], AL

MOV AL, 0FH
MOV [BX+SI+11], AL

MOV AL, 0B0H
MOV [BX+SI+12], AL

MOV AL, 54H
MOV [BX+SI+13], AL

MOV AL, 0BBH
MOV [BX+SI+14], AL

MOV AL, 16H
MOV [BX+SI+15], AL

;STORING 123 MATRIX----------------------------------------------------------------------------------------

MOV BX,1050H

MOV AL, 02H
MOV [BX+0], AL

MOV AL, 03H
MOV [BX+1], AL

MOV AL, 01H
MOV [BX+2], AL

MOV AL, 01H
MOV [BX+3], AL

MOV AL, 01H
MOV [BX+4], AL

MOV AL, 02H
MOV [BX+5], AL

MOV AL, 03H
MOV [BX+6], AL

MOV AL, 01H
MOV [BX+7], AL

MOV AL, 01H
MOV [BX+8], AL

MOV AL, 01H
MOV [BX+9], AL

MOV AL, 02H
MOV [BX+10], AL

MOV AL, 03H
MOV [BX+11], AL

MOV AL, 03H
MOV [BX+12], AL

MOV AL, 01H
MOV [BX+13], AL

MOV AL, 01H
MOV [BX+14], AL

MOV AL, 02H
MOV [BX+15], AL

;STORING ORIGINAL DATA-------------------------------------------------------------------------------------
MOV BX,1000H

MOV AL,32H
MOV [BX],AL
MOV AL,88H
MOV [BX+1],AL
MOV AL,31H
MOV [BX+2],AL
MOV AL,0E0H
MOV [BX+3],AL

MOV AL,43H
MOV [BX+4],AL
MOV AL,5AH
MOV [BX+5],AL
MOV AL,31H
MOV [BX+6],AL
MOV AL,37H
MOV [BX+7],AL

MOV AL,0F6H
MOV [BX+8],AL
MOV AL,30H
MOV [BX+9],AL
MOV AL,98H
MOV [BX+10],AL
MOV AL,07H
MOV [BX+11],AL

MOV AL,0A8H
MOV [BX+12],AL
MOV AL,8DH
MOV [BX+13],AL
MOV AL,0A2H
MOV [BX+14],AL
MOV AL,34H
MOV [BX+15],AL

;STORING ORIGINAL CIPHER KEY-------------------------------------------------------------------------------


MOV BX,1300H
MOV SI, 0

MOV AL, 2BH
MOV [BX+SI+0], AL
MOV AL, 28H
MOV [BX+SI+1], AL
MOV AL, 0ABH
MOV [BX+SI+2], AL
MOV AL, 09H
MOV [BX+SI+3], AL
MOV AL, 7EH
MOV [BX+SI+4], AL
MOV AL, 0AEH
MOV [BX+SI+5], AL
MOV AL, 0F7H
MOV [BX+SI+6], AL
MOV AL, 0CFH
MOV [BX+SI+7], AL
MOV AL, 15H
MOV [BX+SI+8], AL
MOV AL, 0D2H
MOV [BX+SI+9], AL
MOV AL, 15H
MOV [BX+SI+10], AL
MOV AL, 4FH
MOV [BX+SI+11], AL
MOV AL, 16H
MOV [BX+SI+12], AL
MOV AL, 0A6H
MOV [BX+SI+13], AL
MOV AL, 88H
MOV [BX+SI+14], AL
MOV AL, 3CH
MOV [BX+SI+15], AL


;RCON STORED IN COLOUMNS ---------------------------------------------------------------------------------------

MOV BX,1200H
MOV SI, 0

MOV AL, 01H
MOV [BX+SI+0], AL
MOV AL, 02H
MOV [BX+SI+4], AL
MOV AL, 04H
MOV [BX+SI+8], AL
MOV AL, 08H
MOV [BX+SI+12], AL
MOV AL, 10H
MOV [BX+SI+16], AL
MOV AL, 20H
MOV [BX+SI+20], AL
MOV AL, 40H
MOV [BX+SI+24], AL
MOV AL, 80H
MOV [BX+SI+28], AL
MOV AL, 1BH
MOV [BX+SI+32], AL
MOV AL, 36H
MOV [BX+SI+36], AL








      
;XOR ORIGINAL DATA WITH ORIGINAL CIPHER KEY---------------------------------------------------------------------------------------------------
MOV SI,0
MOV BX,1000H
MOV DI,0
LOOPCIPHER:

CMP DI,16
JZ ENDCIPHER
MOV AL,[BX+DI]
MOV CL,[BX +300H+DI]
XOR AL,CL
MOV [BX+DI],AL
INC DI
JMP LOOPCIPHER


ENDCIPHER:
CMP SI,16
JZ BYECIPHER
MOV AL,[BX+SI]
INC SI
LOOP ENDCIPHER
BYECIPHER:





;STORING ROUNDKEYS-----------------------------------------------------------------------------------------------------------------

;R-ROT
MOV BX,1300H
MOV DI,10H

MOV AL,[BX + 7]
MOV [BX + DI + 0],AL 

MOV AL,[BX + 11]
MOV [BX + DI + 1],AL

MOV AL,[BX + 15]
MOV [BX + DI + 2],AL

MOV AL,[BX + 3]
MOV [BX + DI + 3],AL

;DISP R ROT

MOV AL,[BX + DI + 0]

MOV AL,[BX + DI + 1]


MOV AL,[BX + DI + 2]


MOV AL, [BX + DI + 3]


;SUBBYTE R ROT
MOV DI,0
MOV SI,0
MOV BX,1000H
LOOP11:
CMP SI,4
JZ END11
MOV DI,0FH
AND DI,[BX+300H+10H+SI]
MOV CL,0F0H
AND CL,[BX+300H+10H+SI]
SHR CL,4

MOV DL,10H
MOV AL,CL
MUL DL
MOV DX,AX
ADD DI,DX

MOV AL,[BX +100H+ DI]
MOV [BX+300H+10H+ SI],AL
INC SI
JMP LOOP11

END11:

;DISP AFTER SYBBYTE R ROT
MOV DI,10H
MOV BX,1300H

MOV AL,[BX + DI + 0]

MOV AL,[BX + DI + 1]


MOV AL,[BX + DI + 2]


MOV AL, [BX + DI + 3]


; XOR COL 1, RROT RCON

MOV DI,0
MOV SI,0

LOOPKEY:

CMP DI,4
JZ OUTKEY

MOV AL,[BX + 10H + DI];NEW KEY
MOV CL,[1200H +DI]  ;RCON
MOV DL,[1300H+ SI]  ;CIPHER LEY
XOR DL,CL
XOR AL,DL
MOV [BX+DI+10H],AL
ADD SI,4
INC DI
JMP LOOPKEY

OUTKEY:


;DISP AFTER XOR COL1
MOV DI,10H
MOV BX,1300H

MOV AL,[BX + DI + 0]

MOV AL,[BX + DI + 1]


MOV AL,[BX + DI + 2]


MOV AL, [BX + DI + 3]


;XOR 2ND,3RD 4TH COL OF ORIGINAL KEY AND 1ST 2ND 3RD COL OF 1ST ROUND KEY

MOV CX, 1 ;C1
MOV BP, 4 ;C3
MOV SP, 0 ;C2

ROUNDKEY1COL:
 
    CMP CX,4
    JZ EX
    MOV DI,SP;0 4 8
    MOV SI,CX;1 2 3
 
    LOOPKEY2:
    CMP DI,BP;4 8 12
    JZ OUTKEY2
    MOV AX,[1310H + DI];NEW KEY
    MOV DX,[1300H+ SI]  ;CIPHER LEY
    XOR AX,DX
 
    MOV DS:[1310H +DI +4],AX ;4 8 12
    ADD SI,4
    INC DI
    JMP LOOPKEY2
 
    OUTKEY2:
    INC CX
    ADD SP,4
    ADD BP,4
    JMP ROUNDKEY1COL
 



;STOPPPPP HEREEE

;ROUNDKEY2...........

EX:



;------------------------------------------------------------------------------------------------------


;CREATE KEYS--------------------------------------------------

ROUNDKEYALL:

CMP COUNTER1DW,0A0H
JZ EX2

;ROTATING
MOV BX,1300H
MOV BL,COUNTER1DB ;BX 1310
MOV DI,COUNTER2DW ;DI 20

 
                                                                 
MOV AL,[BX+13]        ;1300 +10 +13    ;10 20 30 ....100H

MOV BL,0                          
MOV [BX + DI + 0],AL  ;1300 +20 + 0    ;20 30 40 ....110H
MOV BL,COUNTER1DB


MOV AL,[BX +14]

MOV BL,0
MOV [BX + DI + 1],AL
MOV BL,COUNTER1DB

MOV AL,[BX +15]

MOV BL,0
MOV [BX + DI + 2],AL
MOV BL,COUNTER1DB

MOV AL,[BX +12]

MOV BL,0
MOV [BX + DI + 3],AL
MOV BL,COUNTER1DB



;S-BOXING
 
MOV DI,0
MOV SI,0
MOV BX,1300H
MOV BL,COUNTER2DB

LOOP111:
CMP SI,4
JZ END111
MOV DI,0FH
AND DI,[BX+SI]         ;1300 +20     ;20 30 40 ....110H
MOV CL,0F0H
AND CL,[BX+SI]         ;1300 +20     ;20 30 40 ....110H
SHR CL,4

MOV DL,10H
MOV AL,CL
MUL DL
MOV DX,AX
ADD DI,DX

MOV AL,[1100H+ DI]
MOV [BX + SI],AL        ;1300 +20     ;20 30 40 ....110H
INC SI
JMP LOOP111
 
; FIRST COL
END111:

MOV DI,0
LOOPKEY3:

CMP DI,4
JZ OUTKEY3

MOV AL,[BX + DI];NEW KEY      ;1300 +20 +0 1 2 3    ;20 30 40 ....110H

ADD DI,COUNTER

MOV CL,[1200H +DI]  ;RCON     ;4 8 12 16

SUB DI,COUNTER

MOV BL,COUNTER1DB


MOV DL,[BX+ DI]  ;CIPHER KEY


MOV BL,COUNTER2DB

XOR DL,CL
XOR AL,DL
MOV [BX+DI],AL
INC DI
JMP LOOPKEY3

; REST OF COL
OUTKEY3:
MOV CX, 1 ;C1
MOV BP, 4 ;C3
MOV SP, 0 ;C2
ROUNDKEY1COL1:
    CMP CX,4
    JZ INTERMEDIATE
    MOV DI,SP;0 4 8
 
    LOOPKEY22:
    CMP DI,BP;4 8 12
    JZ OUTKEY22
    MOV AL,[BX+ DI];NEW KEY
 
    MOV BL,COUNTER1DB
 
    MOV DL,[BX +4+ DI]  ;CIPHER KEY
    XOR AL,DL
 
    MOV BL,COUNTER2DB
 
    MOV DS:[BX +DI +4],AL ;4 8 12
    INC DI
    JMP LOOPKEY22
 
    OUTKEY22:
    INC CX
    ADD SP,4
    ADD BP,4
    JMP ROUNDKEY1COL1


INTERMEDIATE:

    ADD COUNTER1DB,16
    ADD COUNTER2DB,16
    ADD COUNTER1DW,16
    ADD COUNTER2DW,16
    ADD COUNTER,4
    JMP ROUNDKEYALL 

EX2:


EXIT:


;STOPPPPP HEEERREEEEEEE
    
MOV BX,1300H
    MOV SI,0
    LOOPTEST2:
    CMP SI,100H
    JZ EXIT2
    MOV AL,[BX + 0 + SI]
    INC SI
    JMP LOOPTEST2
    EXIT2:

    
ENDS